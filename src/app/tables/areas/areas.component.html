<div class="text-2xl font-bold px-1 py-1">{{ 'Thematic areas' | translate}}</div>
<div class="mat-elevation-z8">

  <mat-toolbar class="bg-transparent">

    <div class="flex space-x-4 text-sm items-center mt-5">
      <mat-form-field>
        <mat-label>{{'Search' | translate}}</mat-label>
        <input matInput placeholder="{{'Search' | translate}}" type="text" autocomplete="off" [(ngModel)]="filter.filterQuery" #search>
        <button [class.invisible]="!filter.filterQuery" matSuffix mat-icon-button (click)="clearSearch()">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <span class="flex-auto"></span>
    <div class="mr-2">
      <button mat-raised-button (click)="openDialog()" color="primary">
        <div class="flex items-center space-x-2">
          <mat-icon class="material-icons-outlined">add</mat-icon>
          <span>{{'Add' | translate}}</span>
        </div>
      </button>
    </div>

  </mat-toolbar>
  <div class="h-1">
    <mat-progress-bar mode="indeterminate" mode="query" *ngIf="dataSource.loading$ | async as loading"></mat-progress-bar>
  </div>
  <mat-divider></mat-divider>
  <div class="table-container">
    <table mat-table [dataSource]="dataSource" matSort [matSortActive]="filter.sortColumn" [matSortDirection]="filter.sortDirection">

      <ng-container matColumnDef="code">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'Code' | translate }}</th>
        <td mat-cell *matCellDef="let e" >
          <span class="font-bold">{{e.code}}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'Name' | translate }}</th>
        <td mat-cell *matCellDef="let e" >
          {{e.name}}
        </td>
      </ng-container>

      <ng-container matColumnDef="responsible">
        <th mat-header-cell *matHeaderCellDef>{{ 'Responsible' | translate }}</th>
        <td mat-cell *matCellDef="let e" >
          <!-- <span *ssgUser="e.responsibleUser; let name = name">{{name}}</span> -->
          <span>{{ e.responsibleUser | user }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="delegate">
        <th mat-header-cell *matHeaderCellDef>{{ 'Delegate' | translate }}</th>
        <td mat-cell *matCellDef="let e" >
          <!-- <span *ssgUser="e.delegateUser; let name = name">{{name}}</span> -->
          <!-- <span>{{ !!e.delegateUser ? (e.delegateUser | user) : ('On call duty' | translate) }}</span> -->
          <span *ngIf="!!e.delegateUser" class="bg-transparent px-1 py-1 rounded">{{ e.delegateUser | user }}</span>
          <span *ngIf="!!e.onCallUser" class="bg-slate-200 px-1 py-1 rounded" matTooltip="{{ 'On call duty' | translate }}" matTooltipClass="app-tooltip-small">{{ e.onCallUser | user }}</span>
          <span *ngIf="!e.delegateUser && !e.onCallUser" class="bg-red-200 px-1 py-1 rounded">{{ 'Not available' | translate }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="plant">
        <th mat-header-cell *matHeaderCellDef>{{ 'Plant' | translate }}</th>
        <td mat-cell *matCellDef="let e" >
          <mat-icon class="material-icons-outlined" matTooltip="{{dict[e.plantSetting] | translate}}" matTooltipClass="app-tooltip-small" matTooltipPosition="after">{{icon[e.plantSetting]}}</mat-icon>
        </td>
      </ng-container>

      <ng-container matColumnDef="issues">
        <th mat-header-cell *matHeaderCellDef>{{ 'Issues' | translate }}</th>
        <td mat-cell *matCellDef="let e" >
          <mat-icon class="material-icons-outlined" *ngIf="e.issueCount > 0" matBadge="{{e.issueCount}}" matBadgeSize="medium" matBadgeColor="accent" matBadgePosition="below before">report_problem</mat-icon>
        </td>
      </ng-container>

      <ng-container matColumnDef="attributes">
        <th mat-header-cell *matHeaderCellDef matTooltip="{{'Additional properties' | translate}}" matTooltipClass="app-tooltip-small" matTooltipPosition="after" >{{ 'Prop.' | translate }}</th>
        <td mat-cell *matCellDef="let e" >
          <mat-icon class="material-icons-outlined cursor-pointer" matRipple [matRippleUnbounded]="true" [matRippleCentered]="true" (click)="openAttributes(e)" matBadge="{{ e.attributeCount }}" matBadgeHidden="{{e.attributeCount === 0}}" matBadgePosition="below before">settings</mat-icon>
          <!-- <button mat-icon-button (click)="openAttributes(e)">
            <mat-icon class="material-icons-outlined" matBadge="{{ e.attributeCount }}" matBadgeHidden="{{e.attributeCount === 0}}" matBadgePosition="below before">list_alt</mat-icon>
          </button> -->
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let e">
          <div class="flex justify-end space-x-4" *ngIf="currentRow === e">
            <!-- <button mat-stroked-button (click)="openAttributes(e)" matTooltip="{{'Additional properties' | translate}}" matTooltipClass="app-tooltip">
              <mat-icon class="material-icons-outlined">settings</mat-icon>
            </button> -->
            <button *ngIf="!e.deleted" mat-stroked-button (click)="openDialog(e)" matTooltip="{{'Edit' | translate}}" matTooltipClass="app-tooltip" color="primary">
              <mat-icon class="material-icons-outlined">edit</mat-icon>
            </button>
            <button *ngIf="!e.deleted" (click)="deleteDialog(e)" color="warn" mat-stroked-button matTooltip="{{ (e.issueCount === 0 ? 'Delete forever' : 'Disable') | translate}}" matTooltipClass="app-tooltip">
              <mat-icon class="material-icons-outlined">{{ e.issueCount === 0 ? 'delete_forever' : 'delete' }}</mat-icon>
            </button>
            <button *ngIf="e.deleted" (click)="restore(e)" color="accent" mat-stroked-button matTooltip="{{'Restore' | translate}}" matTooltipClass="app-tooltip">
              <mat-icon class="material-icons-outlined">restore_from_trash</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="custom-arrow"></tr>
      <tr mat-row *matRowDef="let element; columns: displayedColumns;" class="cursor-default hover:bg-gray-100" (mouseover)="onMouseEvent(element)" (mouseleave)="onMouseEvent()"></tr>
    </table>
  </div>
  <mat-paginator class="bg-slate-200" [length]="dataSource.length$ | async" [pageSize]="filter.pageSize" [pageIndex]="filter.pageIndex" [pageSizeOptions]="[10, 20, 50, 100]" showFirstLastButtons></mat-paginator>
  <!-- <mat-toolbar>
    <mat-toolbar-row class="px-0 bg-gray-200">
      <div></div>
      <span class="flex-auto"></span>
      <mat-paginator class="bg-gray-200" [length]="dataSource.length$ | async" [pageSize]="filter.pageSize" [pageIndex]="filter.pageIndex" [pageSizeOptions]="[10, 20, 50, 100]" showFirstLastButtons></mat-paginator>
    </mat-toolbar-row>
  </mat-toolbar> -->

</div>
